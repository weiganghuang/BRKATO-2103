#!/usr/bin/env bash
 
# robot.ova path
 
#ROBOT_OVA_PATH="http://stevenma-mint-01.cisco.com/ova/cw-na-dg-2.0.0-709-TESTONLY-20210318.ova"
 
#ROBOT_OVA_PATH="file://10.140.129.181/home/cwadmin/CNC-2.0-EFT-CW40-EFT-DROP2-2021-03-22/cw-na-dg-2.0.0-709-release-20210318.ova"

ROBOT_OVA_PATH="{{ cdg_ova }}"


VM_NAME="{{ vm_name2 }}"
DM="thin"
Deployment="onpremise-extended"
 
ActiveVnics="{{ active_vnics }}"
 
Hostname="{{ host_name2 }}"
Vnic0IPv4Address="{{ mgmt_ip2 }}"
Vnic0IPv4Gateway="{{ mgmt_gw2  }}"
Vnic0IPv4Netmask="{{ mgmt_mask2 }}"
Vnic0IPv4Method="Static"
 
DNS="8.8.8.8"
NTP="10.140.129.141"
Domain="dish-wireless.net"
 
 
Description="Description for Cisco Crosswork Data Gateway "
Label="Label for Cisco Crosswork Data Gateway"
 
dg_adminPassword="{{ dg_admin_pw }}"
dg_operPassword="{{ dg_oper_pw }}"
 
 
SyslogAddress=""
SyslogPort=514
SyslogProtocol="UDP"
SyslogTLS=False

##Controller Information
CONTROLIP="{{ controller_ip }}"
CONTROLPORT=30607
CONTROLPEM="{{ controller_pem }}"
CONTROLPASS="{{ controller_pw }}"
 
# Please replace this information according to your vcenter setup
VCENTER_LOGIN="Administrator@vsphere.local:Gilli!1234"
VCENTER_PATH="{{ vcenter_path2 }}"
DS="{{ ds2 }}"
NIC0="{{ nic0_2 }}"
NIC1="{{ nic1_2 }}"
NIC2="{{ nic2_2 }}"

        ##--extraConfig:firmware=efi \
        ##--extraConfig:uefi.secureBoot.enabled=true \

 
ovftool --acceptAllEulas \
  --skipManifestCheck \
  --X:injectOvfEnv \
  --overwrite \
  --noSSLVerify \
  --powerOffTarget \
  --powerOn \
        --allowExtraConfig \
        --datastore="$DS" \
  --diskMode="$DM" \
        --name=$VM_NAME \
        --prop:"Hostname=$Hostname" \
  --prop:"Description=$Description" \
        --prop:"Label=$Label" \
        --deploymentOption=$Deployment \
        --prop:"ActiveVnics=$ActiveVnics" \
        --net:"vNIC0=$NIC0" \
        --prop:"Vnic0IPv4Method=$Vnic0IPv4Method" \
        --prop:"Vnic0IPv4Address=$Vnic0IPv4Address" \
        --prop:"Vnic0IPv4Gateway=$Vnic0IPv4Gateway" \
        --prop:"Vnic0IPv4Netmask=$Vnic0IPv4Netmask" \
        --prop:"Vnic0IPv4Method=$Vnic0IPv4Method" \
        --net:"vNIC1=$NIC1" \
        --net:"vNIC2=$NIC2" \
        --prop:"Domain=$Domain" \
        --prop:"DNS=$DNS" \
        --prop:"NTP=$NTP" \
        --prop:"dg-adminPassword=$dg_adminPassword" \
        --prop:"dg-operPassword=$dg_operPassword" \
  --prop:"ControllerIP=$CONTROLIP" \
        --prop:"ControllerPort=$CONTROLPORT" \
        --prop:"ControllerSignCertChain=$CONTROLPEM" \
        --prop:"ControllerCertChainPwd=$CONTROLPASS" \
  --prop:"UseRemoteSyslog=False" \
  --prop:"SyslogAddress=$SyslogAddress" \
  --prop:"SyslogPort=$SyslogPort" \
  --prop:"SyslogProtocol=$SyslogProtocol" \
  --prop:"SyslogTLS=$SyslogTLS" \
    $ROBOT_OVA_PATH vi://$VCENTER_LOGIN@$VCENTER_PATH